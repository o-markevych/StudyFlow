@page "/upload"
@using Microsoft.AspNetCore.Components.Forms

<PageTitle>Upload PDF - StudyFlow</PageTitle>

<div class="upload-container">
    <div class="upload-header">
        <h1 class="display-4 fw-bold mb-3">
            <span class="gradient-text">Upload Your PDF</span>
        </h1>
        <p class="lead text-muted">Begin your journey to smarter studying</p>
    </div>

    <div class="upload-card">
        <InputFile OnChange="HandleFileSelection" accept=".pdf" class="file-input" id="fileInput" />
        
        <label for="fileInput" class="upload-area @(isDragging ? "dragging" : "")">
            @if (selectedFile == null)
            {
                <div class="upload-prompt">
                    <div class="upload-icon">üì§</div>
                    <h3>Drop your PDF here</h3>
                    <p class="text-muted">or click to browse</p>
                    <p class="file-info">Supported format: PDF (Max 50MB)</p>
                </div>
            }
            else
            {
                <div class="file-selected">
                    <div class="file-icon">üìÑ</div>
                    <h4>@selectedFile.Name</h4>
                    <p class="text-muted">@FormatFileSize(selectedFile.Size)</p>
                    <button type="button" class="btn-remove" @onclick="RemoveFile" @onclick:stopPropagation="true">
                        Remove
                    </button>
                </div>
            }
        </label>

        @if (selectedFile != null && !isProcessing)
        {
            <button class="btn-process" @onclick="ProcessPdf">
                <span>Process PDF</span>
                <span class="arrow">‚Üí</span>
            </button>
        }

        @if (isProcessing)
        {
            <div class="processing-indicator">
                <div class="spinner"></div>
                <p>Processing your PDF...</p>
            </div>
        }

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="error-message">
                ‚ö†Ô∏è @errorMessage
            </div>
        }
    </div>
</div>

@code {
    private IBrowserFile? selectedFile;
    private bool isDragging = false;
    private bool isProcessing = false;
    private string errorMessage = string.Empty;
    private const long maxFileSize = 50 * 1024 * 1024; // 50MB

    private async Task HandleFileSelection(InputFileChangeEventArgs e)
    {
        errorMessage = string.Empty;
        var file = e.File;

        if (file.ContentType != "application/pdf")
        {
            errorMessage = "Please select a valid PDF file.";
            return;
        }

        if (file.Size > maxFileSize)
        {
            errorMessage = $"File size exceeds the maximum limit of 50MB.";
            return;
        }

        selectedFile = file;
    }

    private void RemoveFile()
    {
        selectedFile = null;
        errorMessage = string.Empty;
    }

    private async Task ProcessPdf()
    {
        if (selectedFile == null) return;

        isProcessing = true;
        errorMessage = string.Empty;

        try
        {
            // TODO: Implement PDF processing logic
            // 1. Upload file to server/storage
            // 2. Extract content using AI
            // 3. Enrich with web data
            // 4. Create study system

            await Task.Delay(2000); // Simulated processing

            // TODO: Navigate to study system page after processing
            // NavigationManager.NavigateTo($"/study/{studyId}");
        }
        catch (Exception ex)
        {
            errorMessage = $"Error processing PDF: {ex.Message}";
        }
        finally
        {
            isProcessing = false;
        }
    }

    private string FormatFileSize(long bytes)
    {
        string[] sizes = { "B", "KB", "MB", "GB" };
        double len = bytes;
        int order = 0;
        while (len >= 1024 && order < sizes.Length - 1)
        {
            order++;
            len = len / 1024;
        }
        return $"{len:0.##} {sizes[order]}";
    }
}

<style>
    .upload-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }

    .upload-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .gradient-text {
        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .upload-card {
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .file-input {
        display: none;
    }

    .upload-area {
        display: block;
        padding: 4rem 2rem;
        border: 3px dashed #cbd5e1;
        border-radius: 0.75rem;
        background: #f8fafc;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .upload-area:hover {
        border-color: #6366f1;
        background: #f0f4ff;
    }

    .upload-area.dragging {
        border-color: #6366f1;
        background: #e0e7ff;
        transform: scale(1.02);
    }

    .upload-prompt {
        text-align: center;
    }

    .upload-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .upload-prompt h3 {
        color: #1e293b;
        margin-bottom: 0.5rem;
    }

    .file-info {
        font-size: 0.875rem;
        color: #94a3b8;
        margin-top: 1rem;
    }

    .file-selected {
        text-align: center;
    }

    .file-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .file-selected h4 {
        color: #1e293b;
        margin-bottom: 0.5rem;
        word-break: break-word;
    }

    .btn-remove {
        margin-top: 1rem;
        padding: 0.5rem 1.5rem;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-remove:hover {
        background: #dc2626;
        transform: translateY(-2px);
    }

    .btn-process {
        width: 100%;
        margin-top: 1.5rem;
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-size: 1.125rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .btn-process:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
    }

    .btn-process .arrow {
        font-size: 1.5rem;
        transition: transform 0.3s ease;
    }

    .btn-process:hover .arrow {
        transform: translateX(5px);
    }

    .processing-indicator {
        text-align: center;
        padding: 2rem;
        margin-top: 1.5rem;
    }

    .spinner {
        width: 48px;
        height: 48px;
        margin: 0 auto 1rem;
        border: 4px solid #e0e7ff;
        border-top-color: #6366f1;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        to { transform: rotate(360deg); }
    }

    .processing-indicator p {
        color: #6366f1;
        font-weight: 500;
    }

    .error-message {
        margin-top: 1.5rem;
        padding: 1rem;
        background: #fef2f2;
        border: 1px solid #fecaca;
        border-radius: 0.5rem;
        color: #dc2626;
        text-align: center;
    }

    @@media (prefers-color-scheme: dark) {
        .upload-card {
            background: #1f2937;
        }

        .upload-area {
            background: #111827;
            border-color: #374151;
        }

        .upload-area:hover {
            background: #1e293b;
            border-color: #818cf8;
        }

        .upload-area.dragging {
            background: #312e81;
            border-color: #818cf8;
        }

        .upload-prompt h3,
        .file-selected h4 {
            color: #f1f5f9;
        }

        .error-message {
            background: #7f1d1d;
            border-color: #991b1b;
            color: #fca5a5;
        }
    }

    @@media (max-width: 640px) {
        .upload-area {
            padding: 3rem 1rem;
        }

        .upload-icon,
        .file-icon {
            font-size: 3rem;
        }
    }
</style>
